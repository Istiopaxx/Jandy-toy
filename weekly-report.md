# Weekly Report - 주간 보고서
* * *

### 2021년 3월 28일 - 3월 4주차

REST API 통신을 이용한 Interactive Problem Solving  채점 시스템을 구현하는 프로젝트이다. 
Node.js를 서버 런타임으로, express 웹 프레임워크를 사용한다. 뷰 모델은 react.js로 구성하고, ant-design 라이브러리를 활용한다.
뷰모델과 컨트롤러를 구성해두었음. 


* * *
- - -


### 2021년 4월 4일 - 4월 1주차

express가 서버사이드를 맡아서 react와 api 통신을 하는 구성을 만들었다. react(클라이언트 사이드)는 포트 3000, express(서버 사이드)는 포트 3001을 써서 서로 api통신을 하려고 하니 크로스 오리진 이슈(CORS)가 떴다. 그래서 프록시 설정을 통해 클라이언트 측에서 api 요청을 하면 3001번 포트로 요청이 가게 설정하였다. http-proxy-middleware 라이브러리 활용함. db 연결을 안해놓아서 일단은 더미데이터를 직접 넣어 렌더링이 잘 되는지 확인함.

##### 할 것
1. 리액트 hook 공부 후 복잡한 렌더링 로직 단순화
2. 웹 소켓 공부 
3. 사용자 tokenize, 문제 데이터 구상

* * *
- - -

### 2021년 4월 11일 - 4월 2주차

1. api 서버에서 렌더링할 데이터를 불러와 렌더링 하는 로직에서 컴포넌트 state가 초기에 null로 되어 있으면 render함수 호출 시에 map같은 함수들이 오류나는 일이 있어 state를 선언시 일일히 초기화 시켜주는 구조였다. api 데이터가 복잡한 json이 들어온다면 선언시 초기화는 비용이 많이 들어 가이드라인을 검색해보니 초기에 빈 배열이나 빈 객체를 선언해주고 render 함수 내에서 const { someState } = this.state 이런식으로 사용하고 있어 그렇게 리팩토링 하였다. 
2. 웹소켓과 node js 기반 웹소켓 라이브러리인 socket.io를 공부하였다.

#### 생각해야 할 부분
사용자가 문제 채점 시 사용자의 프로그램은 클라이언트 측에서 구동하고, problem environment 데이터와 사용자의 action 데이터만 통신으로 오가게 하고 싶다. 사용자의 소스코드를 서버에서 실행시키는 것은 코드가 악의적 의도로 작성되었을 시 서버에 악영향을 끼칠 수 있고, 서버 측 컴퓨팅 자원에 부족이 생길 수 있다고 생각하기 때문이다. 다만 그러기 위해서 사용자 측이 서버와 통신할 프로토콜이 중요한데, 이를 양방향으로 하기 위해 websocket을 사용하는 방향으로 구상했다. 문제는, 사용자가 채점 코드에 websocket을 작성하는 부분이 아니라는 것인데, 서버-클라이언트(브라우저)-채점 코드(채점자 측 프로그램 인스턴스) 간에 어떤 information redirection 방식이 있어야 할지 구상해봐야 할 것 같다.

#### 할 것
1. 사용자 측 채점 코드와 브라우저가 어떻게 데이터를 교환할 수 있게 할지 찾아 볼 것

* * *
- - -


### 2021년 5월 2일 - 5월 1주차

1. 시험 전까지 웹소켓으로 구현하는 것을 목표로 웹소켓을 공부했는데, 우선은 http 통신을 이용하는게 더 쉬울 것 같아 http 버전으로 구현하였다. 웹소켓으로 구현하는 것은 나중에 추가하는 것을 고려해볼 것 같다. 
2. 라우트와 컨트롤러로 나누어 구현하였다. 라우트에 해당 path로 들어오는 요청에 대해 컨트롤러를 호출해서 미들웨어로 넘겨주는 형식이다.
3. 각 채점자의 인증을 기본적인 해싱을 이용한 토큰으로 하려다가 토큰 만료 시간과 각 채점자의 정보를 채점db에서 액세스하여 가져오는 것은 비효율적인 것 같아 json web token을 이용하였다. 페이로드는 최대한 작은 크기로 하기위해 유저id와 문제id만 담고, jsonwebtoken 라이브러리를 이용하였다.
4. 채점 db는 빠른 액세스가 생명이라 인 메모리, 토큰을 키로 하고 채점 상태를 값으로 하는 key-value 데이터베이스를 사용할 생각이다. Redis로 정했음.


#### 할 것
1. 채점 DB(redis) 깔고 연결해서 잘 통신되는지 확인해야 함.
2. action api가 아직 구현되지 않음. 문제 명세를 상세히 정하고 action 컨트롤러를 구현해야 한다.



### 2021년 5월 9일 - 5월 2주차

1. 데이터베이스 연동까지 하기엔 부족해서 ./servers/app.js에 테스트 데이터로 db역할을 대신하기로 했다.
2. start, onState, action api는 모두 구현했고 curl로 통신해봤는데 엔드 투 엔드로 테스트한 것은 아니지만 일단은 잘된다.
3. 채점 종료조건까지 테스트해보지 않아서 그 부분의 디버깅은 못했다.
4. 굳이 뷰가 필요할까 싶어서 뷰를 담당하는 코드는 전부 없앴다.


#### 대충 완성하고 소감

node와 express로 request를 지지고 볶는 과정에 대해 직접 해보는 기회가 되었다. 특히 action api를 호출하면 사용자가 보낸 커맨드에 따라 state를 조작하는게 꽤 복잡했기 때문에 거기를 구현하는게 좋은 경험이었다. 후에 문제를 추가할 것을 대비해서 캡슐화를 잘했으면 어땟을지 아쉽긴 하지만 차후 리팩토링 할 부분인 것 같다. 




